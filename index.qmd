---
title: "2026 UTB Season"
date: today
date-format: "[Last Updated:] MMMM D, YYYY"
format: 
  dashboard:
    theme: darkly
    embed-resources: true
---

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(googlesheets4)
library(plotly)

sheet_url <- "[https://docs.google.com/spreadsheets/d/1hx6q_yFV6p0UF8IXgp2eOsckzwPDne_aQdf6LC1gKAM/edit?usp=sharing](https://docs.google.com/spreadsheets/d/1hx6q_yFV6p0UF8IXgp2eOsckzwPDne_aQdf6LC1gKAM/edit?usp=sharing)"

# Load both tabs
riders_df <- read_sheet(sheet_url, sheet = "Bull Riders")
events_raw <- read_sheet(sheet_url, sheet = "Events")

```
## Row {height=20%}

### 90-Point Club
```{r}
events_raw %>%
  filter(Score >= 90) %>%
  select(Rider_Name, Bull_Name, Score) %>%
  knitr::kable()
```
## Row {height="40%"}
### 2026 World Standings {width="65%"}


```{r}
#| message: false
#| warning: false
riders_clean <- riders_df %>%
  filter(!is.na(Rider)) %>% 
  mutate(Points = as.numeric(Points)) %>%
  group_by(Rider) %>% 
  summarise(Points = sum(Points, na.rm = TRUE)) %>%
  slice_max(order_by = Points, n = 15) %>%
  arrange(Points)

p1 <- ggplot(riders_clean, aes(x = reorder(Rider, Points), y = Points, fill = Points)) +
  geom_col() +
  scale_fill_gradient(low = "#C5A059", high = "#FFD700") +
  coord_flip() +
  labs(x = NULL, y = "Total Points") +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "black", color = "black"),
    panel.background = element_rect(fill = "black", color = "black"),
    text = element_text(color = "#FFD700"),
    axis.text = element_text(color = "white", size = 10),
    legend.position = "none"
  )
ggplotly(p1) %>% layout(plot_bgcolor = "black", paper_bgcolor = "black")
```

### Riding Efficiency {width="35%"}

```{r}
#| message: false
#| warning: false
ride_stats <- events_raw %>%
  filter(!is.na(Rider_Name)) %>% 
  group_by(Rider_Name) %>% 
  summarise(
    Outs = n(),
    Rides = sum(as.numeric(Score) > 0, na.rm = TRUE),
    Pct = round((Rides / Outs) * 100, 1)
  ) %>%
  slice_max(order_by = Pct, n = 15, with_ties = FALSE)

ggplot(ride_stats, aes(x = Pct, y = reorder(Rider_Name, Pct))) + 
  geom_col(fill = "#FFD700") +
  geom_text(aes(label = paste0(Pct, "%")),
            hjust = -0.1, color = "white", size = 3) +
  labs(title = "Riding Efficiency", x = "Ride %", y = NULL) +
  theme(
    plot.background = element_rect(fill = "black", color = NA),
    panel.background = element_rect(fill = "black", color = NA),
    text = element_text(color = "#FFD700"),
    axis.text.y = element_text(color = "white", size = 8),
    axis.text.x = element_text(color = "white"),
    panel.grid = element_blank()
  )
```
## Row {height="35%"}

### YETI World Champion Bull Race {width="70%"}

```{r}
#| message: false
#| warning: false

bull_standings <- events_raw %>%
  filter(!is.na(Bull_Name), !is.na(Bull_Score)) %>%
  mutate(Bull_Score = as.numeric(Bull_Score)) %>%
  group_by(Bull_Name) %>%
  summarise(Avg_Score = mean(Bull_Score, na.rm = TRUE), Outs = n()) %>%
  slice_max(order_by = Avg_Score, n = 10) %>%
  arrange(Avg_Score)

p_bulls <- ggplot(bull_standings, aes(x = reorder(Bull_Name, Avg_Score), y = Avg_Score, fill = Avg_Score)) +
  geom_col() +
  scale_fill_gradient(low = "#C5A059", high = "#FFD700") +
  coord_flip(ylim = c(40, 46)) +
  labs(x = NULL, y = "Avg Score") +
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = "black"),
    panel.background = element_rect(fill = "black"),
    text = element_text(color = "#FFD700"),
    axis.text = element_text(color = "white"),
    legend.position = "none"
  )
ggplotly(p_bulls) %>% layout(plot_bgcolor = "black", paper_bgcolor = "black")
```
### Bull of the Event

```{r}
#| message: false
#| warning: false

bull_winners <- events_raw %>%
  filter(!is.na(Location), !is.na(Bull_Score)) %>%
  group_by(Location) %>% 
  slice_max(order_by = Bull_Score, n = 1, with_ties = FALSE) %>%
  select(Location, Bull_Name, Bull_Score) %>%
  arrange(desc(Bull_Score))

# Adding a caption here also helps the title show up!
knitr::kable(bull_winners, col.names = c("City", "Bull", "Score"))

```